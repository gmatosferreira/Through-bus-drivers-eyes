---
title: "Events: Short Turnings"
format: gfm
---


```{r}
#| echo: true
#| eval: false
events_32 = read.csv("csv/events_20250501_20250531_bus_categorised_category_32.csv") # Using short turning events (ID 11)

shortenings = events_32 |>
  arrange(timestamp, .by_group = TRUE) |>
  mutate(
    timestamp = as.POSIXct(timestamp / 1000, origin = "1970-01-01", tz = "UTC"), 
    date = as.Date(timestamp),
    hh = as.integer(format(timestamp, "%H"))
  )

shortenings_summary_per_route = shortenings |>
  group_by(RouteNumber) |> 
  summarise(
    n = n(),
    avg_per_day = n/31,
    pct_total = n / shortenings_summary$n * 100
  ) |> 
  ungroup() |> 
  left_join(trips_planned_may_per_route |> dplyr::select(route_short_name, n) |> rename(n_planned=n), by=c("RouteNumber"="route_short_name")) |>
  mutate(
    pct_shortened_vs_planned = n / n_planned * 100
  ) |> 
  arrange(desc(pct_shortened_vs_planned))
```

